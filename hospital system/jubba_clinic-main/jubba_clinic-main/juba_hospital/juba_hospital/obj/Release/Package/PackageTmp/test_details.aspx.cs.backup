using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data.SqlClient;
using System.Linq;
using System.Web;
using System.Web.Services;
using System.Web.UI;
using System.Web.UI.WebControls;
using static juba_hospital.assignmed;
using static juba_hospital.lap_operation;

namespace juba_hospital
{
    public partial class test_details : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {

        }
        [WebMethod]
        public static string updatetest(
      string id,
      string flexCheckGeneralUrineExamination1, string flexCheckProgesteroneFemale1, string flexCheckAmylase1, string flexCheckMagnesium1,
      string flexCheckPhosphorous1, string flexCheckCalcium1, string flexCheckChloride1, string flexCheckPotassium1,
      string flexCheckSodium1, string flexCheckUricAcid1, string flexCheckCreatinine1, string flexCheckUrea1,
      string flexCheckJGlobulin1, string flexCheckAlbumin1, string flexCheckTotalBilirubin1, string flexCheckAlkalinePhosphatesALP1,
      string flexCheckSGOTAST1, string flexCheckSGPTALT1, string flexCheckLiverFunctionTest1, string flexCheckTriglycerides1,
      string flexCheckTotalCholesterol1, string flexCheckHemoglobinA1c1, string flexCheckHDL1, string flexCheckLDL1,
      string flexCheckFSH1, string flexCheckEstradiol1, string flexCheckLH1,
      string flexCheckTestosteroneMale1, string flexCheckProlactin1, string flexCheckSeminalFluidAnalysis1, string flexCheckBHCG1,
      string flexCheckUrineExamination1, string flexCheckStoolExamination1, string flexCheckHemoglobin1, string flexCheckMalaria1,
      string flexCheckESR1, string flexCheckBloodGrouping1, string flexCheckBloodSugar1, string flexCheckCBC1,
      string flexCheckCrossMatching1, string flexCheckTPHA1, string flexCheckHIV1, string flexCheckHBV1,
      string flexCheckHCV1, string flexCheckBrucellaMelitensis1, string flexCheckBrucellaAbortus1, string flexCheckCRP1,
      string flexCheckRF1, string flexCheckASO1, string flexCheckToxoplasmosis1, string flexCheckTyphoid1,
      string flexCheckHpyloriAntibody1, string flexCheckStoolOccultBlood1, string flexCheckGeneralStoolExamination1, string flexCheckThyroidProfile1,
      string flexCheckT31, string flexCheckT41, string flexCheckTSH1, string flexCheckSpermExamination1,
      string flexCheckVirginalSwab1, string flexCheckTrichomonasVirginals1, string flexCheckHCG1, string flexCheckHpyloriAgStool1,
      string flexCheckFastingBloodSugar1, string flexCheckDirectBilirubin1
  )
        {
            try
            {
                string cs = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;
                using (SqlConnection conn = new SqlConnection(cs))
                {
                    conn.Open();
                    using (SqlCommand cmd = new SqlCommand("UPDATE lab_results SET " +
                        "General_urine_examination = @flexCheckGeneralUrineExamination1, " +
                        "Progesterone_Female = @flexCheckProgesteroneFemale1, " +
                        "Amylase = @flexCheckAmylase1, " +
                        "Magnesium = @flexCheckMagnesium1, " +
                        "Phosphorous = @flexCheckPhosphorous1, " +
                        "Calcium = @flexCheckCalcium1, " +
                        "Chloride = @flexCheckChloride1, " +
                        "Potassium = @flexCheckPotassium1, " +
                        "Sodium = @flexCheckSodium1, " +
                        "Uric_acid = @flexCheckUricAcid1, " +
                        "Creatinine = @flexCheckCreatinine1, " +
                        "Urea = @flexCheckUrea1, " +
                        "JGlobulin = @flexCheckJGlobulin1, " +
                        "Albumin = @flexCheckAlbumin1, " +
                        "Total_bilirubin = @flexCheckTotalBilirubin1, " +
                        "Alkaline_phosphates_ALP = @flexCheckAlkalinePhosphatesALP1, " +
                        "SGOT_AST = @flexCheckSGOTAST1, " +
                        "SGPT_ALT = @flexCheckSGPTALT1, " +
                        "Liver_function_test = @flexCheckLiverFunctionTest1, " +
                        "Triglycerides = @flexCheckTriglycerides1, " +
                        "Total_cholesterol = @flexCheckTotalCholesterol1, " +
                        "Hemoglobin_A1c = @flexCheckHemoglobinA1c1, " +
                        "High_density_lipoprotein_HDL = @flexCheckHDL1, " +
                        "Low_density_lipoprotein_LDL = @flexCheckLDL1, " +
                        "Follicle_stimulating_hormone_FSH = @flexCheckFSH1, " +
                        "Estradiol = @flexCheckEstradiol1, " +
                        "Luteinizing_hormone_LH = @flexCheckLH1, " +
                        "Testosterone_Male = @flexCheckTestosteroneMale1, " +
                        "Prolactin = @flexCheckProlactin1, " +
                        "Seminal_Fluid_Analysis_Male_B_HCG = @flexCheckSeminalFluidAnalysis1, " +
                        "Clinical_path = @flexCheckBHCG1, " +
                        "Urine_examination = @flexCheckUrineExamination1, " +
                        "Stool_examination = @flexCheckStoolExamination1, " +
                        "Hemoglobin = @flexCheckHemoglobin1, " +
                        "Malaria = @flexCheckMalaria1, " +
                        "ESR = @flexCheckESR1, " +
                        "Blood_grouping = @flexCheckBloodGrouping1, " +
                        "Blood_sugar = @flexCheckBloodSugar1, " +
                        "CBC = @flexCheckCBC1, " +
                        "Cross_matching = @flexCheckCrossMatching1, " +
                        "TPHA = @flexCheckTPHA1, " +
                        "Human_immune_deficiency_HIV = @flexCheckHIV1, " +
                        "Hepatitis_B_virus_HBV = @flexCheckHBV1, " +
                        "Hepatitis_C_virus_HCV = @flexCheckHCV1, " +
                        "Brucella_melitensis = @flexCheckBrucellaMelitensis1, " +
                        "Brucella_abortus = @flexCheckBrucellaAbortus1, " +
                        "C_reactive_protein_CRP = @flexCheckCRP1, " +
                        "Rheumatoid_factor_RF = @flexCheckRF1, " +
                        "Antistreptolysin_O_ASO = @flexCheckASO1, " +
                        "Toxoplasmosis = @flexCheckToxoplasmosis1, " +
                        "Typhoid_hCG = @flexCheckTyphoid1, " +
                        "Hpylori_antibody = @flexCheckHpyloriAntibody1, " +
                        "Stool_occult_blood = @flexCheckStoolOccultBlood1, " +
                        "General_stool_examination = @flexCheckGeneralStoolExamination1, " +
                        "Thyroid_profile = @flexCheckThyroidProfile1, " +
                        "Triiodothyronine_T3 = @flexCheckT31, " +
                        "Thyroxine_T4 = @flexCheckT41, " +
                        "Thyroid_stimulating_hormone_TSH = @flexCheckTSH1, " +
                        "Sperm_examination = @flexCheckSpermExamination1, " +
                        "Virginal_swab_trichomonas_virginals = @flexCheckVirginalSwab1, " +
                        "Human_chorionic_gonadotropin_hCG = @flexCheckTrichomonasVirginals1, " +
                        "Hpylori_Ag_stool = @flexCheckHpyloriAgStool1, " +
                        "Fasting_blood_sugar = @flexCheckFastingBloodSugar1, " +
                        "Direct_bilirubin = @flexCheckDirectBilirubin1 " +
                        "WHERE lab_result_id = @id", conn))
                    {
                        cmd.Parameters.AddWithValue("@id", id);
                        cmd.Parameters.AddWithValue("@flexCheckGeneralUrineExamination1", flexCheckGeneralUrineExamination1);
                        cmd.Parameters.AddWithValue("@flexCheckProgesteroneFemale1", flexCheckProgesteroneFemale1);
                        cmd.Parameters.AddWithValue("@flexCheckAmylase1", flexCheckAmylase1);
                        cmd.Parameters.AddWithValue("@flexCheckMagnesium1", flexCheckMagnesium1);
                        cmd.Parameters.AddWithValue("@flexCheckPhosphorous1", flexCheckPhosphorous1);
                        cmd.Parameters.AddWithValue("@flexCheckCalcium1", flexCheckCalcium1);
                        cmd.Parameters.AddWithValue("@flexCheckChloride1", flexCheckChloride1);
                        cmd.Parameters.AddWithValue("@flexCheckPotassium1", flexCheckPotassium1);
                        cmd.Parameters.AddWithValue("@flexCheckSodium1", flexCheckSodium1);
                        cmd.Parameters.AddWithValue("@flexCheckUricAcid1", flexCheckUricAcid1);
                        cmd.Parameters.AddWithValue("@flexCheckCreatinine1", flexCheckCreatinine1);
                        cmd.Parameters.AddWithValue("@flexCheckUrea1", flexCheckUrea1);
                        cmd.Parameters.AddWithValue("@flexCheckJGlobulin1", flexCheckJGlobulin1);
                        cmd.Parameters.AddWithValue("@flexCheckAlbumin1", flexCheckAlbumin1);
                        cmd.Parameters.AddWithValue("@flexCheckTotalBilirubin1", flexCheckTotalBilirubin1);
                        cmd.Parameters.AddWithValue("@flexCheckAlkalinePhosphatesALP1", flexCheckAlkalinePhosphatesALP1);
                        cmd.Parameters.AddWithValue("@flexCheckSGOTAST1", flexCheckSGOTAST1);
                        cmd.Parameters.AddWithValue("@flexCheckSGPTALT1", flexCheckSGPTALT1);
                        cmd.Parameters.AddWithValue("@flexCheckLiverFunctionTest1", flexCheckLiverFunctionTest1);
                        cmd.Parameters.AddWithValue("@flexCheckTriglycerides1", flexCheckTriglycerides1);
                        cmd.Parameters.AddWithValue("@flexCheckTotalCholesterol1", flexCheckTotalCholesterol1);
                        cmd.Parameters.AddWithValue("@flexCheckHemoglobinA1c1", flexCheckHemoglobinA1c1);
                        cmd.Parameters.AddWithValue("@flexCheckHDL1", flexCheckHDL1);
                        cmd.Parameters.AddWithValue("@flexCheckLDL1", flexCheckLDL1);
                        cmd.Parameters.AddWithValue("@flexCheckFSH1", flexCheckFSH1);
                        cmd.Parameters.AddWithValue("@flexCheckEstradiol1", flexCheckEstradiol1);
                        cmd.Parameters.AddWithValue("@flexCheckLH1", flexCheckLH1);
                        cmd.Parameters.AddWithValue("@flexCheckTestosteroneMale1", flexCheckTestosteroneMale1);
                        cmd.Parameters.AddWithValue("@flexCheckProlactin1", flexCheckProlactin1);
                        cmd.Parameters.AddWithValue("@flexCheckSeminalFluidAnalysis1", flexCheckSeminalFluidAnalysis1);
                        cmd.Parameters.AddWithValue("@flexCheckBHCG1", flexCheckBHCG1);
                        cmd.Parameters.AddWithValue("@flexCheckUrineExamination1", flexCheckUrineExamination1);
                        cmd.Parameters.AddWithValue("@flexCheckStoolExamination1", flexCheckStoolExamination1);
                        cmd.Parameters.AddWithValue("@flexCheckHemoglobin1", flexCheckHemoglobin1);
                        cmd.Parameters.AddWithValue("@flexCheckMalaria1", flexCheckMalaria1);
                        cmd.Parameters.AddWithValue("@flexCheckESR1", flexCheckESR1);
                        cmd.Parameters.AddWithValue("@flexCheckBloodGrouping1", flexCheckBloodGrouping1);
                        cmd.Parameters.AddWithValue("@flexCheckBloodSugar1", flexCheckBloodSugar1);
                        cmd.Parameters.AddWithValue("@flexCheckCBC1", flexCheckCBC1);
                        cmd.Parameters.AddWithValue("@flexCheckCrossMatching1", flexCheckCrossMatching1);
                        cmd.Parameters.AddWithValue("@flexCheckTPHA1", flexCheckTPHA1);
                        cmd.Parameters.AddWithValue("@flexCheckHIV1", flexCheckHIV1);
                        cmd.Parameters.AddWithValue("@flexCheckHBV1", flexCheckHBV1);
                        cmd.Parameters.AddWithValue("@flexCheckHCV1", flexCheckHCV1);
                        cmd.Parameters.AddWithValue("@flexCheckBrucellaMelitensis1", flexCheckBrucellaMelitensis1);
                        cmd.Parameters.AddWithValue("@flexCheckBrucellaAbortus1", flexCheckBrucellaAbortus1);
                        cmd.Parameters.AddWithValue("@flexCheckCRP1", flexCheckCRP1);
                        cmd.Parameters.AddWithValue("@flexCheckRF1", flexCheckRF1);
                        cmd.Parameters.AddWithValue("@flexCheckASO1", flexCheckASO1);
                        cmd.Parameters.AddWithValue("@flexCheckToxoplasmosis1", flexCheckToxoplasmosis1);
                        cmd.Parameters.AddWithValue("@flexCheckTyphoid1", flexCheckTyphoid1);
                        cmd.Parameters.AddWithValue("@flexCheckHpyloriAntibody1", flexCheckHpyloriAntibody1);
                        cmd.Parameters.AddWithValue("@flexCheckStoolOccultBlood1", flexCheckStoolOccultBlood1);
                        cmd.Parameters.AddWithValue("@flexCheckGeneralStoolExamination1", flexCheckGeneralStoolExamination1);
                        cmd.Parameters.AddWithValue("@flexCheckThyroidProfile1", flexCheckThyroidProfile1);
                        cmd.Parameters.AddWithValue("@flexCheckT31", flexCheckT31);
                        cmd.Parameters.AddWithValue("@flexCheckT41", flexCheckT41);
                        cmd.Parameters.AddWithValue("@flexCheckTSH1", flexCheckTSH1);
                        cmd.Parameters.AddWithValue("@flexCheckSpermExamination1", flexCheckSpermExamination1);
                        cmd.Parameters.AddWithValue("@flexCheckVirginalSwab1", flexCheckVirginalSwab1);
                        cmd.Parameters.AddWithValue("@flexCheckTrichomonasVirginals1", flexCheckTrichomonasVirginals1);
                        cmd.Parameters.AddWithValue("@flexCheckHpyloriAgStool1", flexCheckHpyloriAgStool1);
                        cmd.Parameters.AddWithValue("@flexCheckFastingBloodSugar1", flexCheckFastingBloodSugar1);
                        cmd.Parameters.AddWithValue("@flexCheckDirectBilirubin1", flexCheckDirectBilirubin1);

                        cmd.ExecuteNonQuery();
                    }
                }

                return "Data Updated Successfully";
            }
            catch (Exception ex)
            {
                return "An error occurred: " + ex.Message;
            }
        }

        [WebMethod]
        public static ptclass1[] editlabmedic(string prescid)
        {
            List<ptclass1> details = new List<ptclass1>();
            string cs = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;

            using (SqlConnection con = new SqlConnection(cs))
            {
                con.Open();
                SqlCommand cmd = new SqlCommand(@"

  SELECT 
    lab_results.lab_result_id,
    lab_results.Low_density_lipoprotein_LDL,
    lab_results.High_density_lipoprotein_HDL,
    lab_results.Total_cholesterol,
    lab_results.Triglycerides,
    lab_results.SGPT_ALT,
    lab_results.SGOT_AST,
    lab_results.Alkaline_phosphates_ALP,
    lab_results.Total_bilirubin,
    lab_results.Direct_bilirubin,
    lab_results.Albumin,
    lab_results.JGlobulin,
    lab_results.Urea,
    lab_results.Creatinine,
    lab_results.Uric_acid,
    lab_results.Sodium,
    lab_results.Potassium,
    lab_results.Chloride,
    lab_results.Calcium,
    lab_results.Phosphorous,
    lab_results.Magnesium,
    lab_results.Amylase,
    lab_results.Hemoglobin,
    lab_results.Malaria,
    lab_results.ESR,
    lab_results.Blood_grouping,
    lab_results.Blood_sugar,
    lab_results.CBC,
    lab_results.Cross_matching,
    lab_results.TPHA,
    lab_results.Human_immune_deficiency_HIV,
    lab_results.Hepatitis_B_virus_HBV,
    lab_results.Hepatitis_C_virus_HCV,
    lab_results.Brucella_melitensis,
    lab_results.Brucella_abortus,
    lab_results.C_reactive_protein_CRP,
    lab_results.Rheumatoid_factor_RF,
    lab_results.Antistreptolysin_O_ASO,
    lab_results.Toxoplasmosis,
    lab_results.Typhoid_hCG,
    lab_results.Hpylori_antibody,
    lab_results.Stool_occult_blood,
    lab_results.General_stool_examination,
    lab_results.Thyroid_profile,
    lab_results.Triiodothyronine_T3,
    lab_results.Thyroxine_T4,
    lab_results.Thyroid_stimulating_hormone_TSH,
    lab_results.Progesterone_Female,
    lab_results.Follicle_stimulating_hormone_FSH,
    lab_results.Estradiol,
    lab_results.Luteinizing_hormone_LH,
    lab_results.Testosterone_Male,
    lab_results.Prolactin,
    lab_results.Seminal_Fluid_Analysis_Male_B_HCG,
    lab_results.Urine_examination,
    lab_results.Stool_examination,
    lab_results.Sperm_examination,
    lab_results.Virginal_swab_trichomonas_virginals,
    lab_results.Human_chorionic_gonadotropin_hCG,
    lab_results.Hpylori_Ag_stool,
    lab_results.Fasting_blood_sugar,
    lab_results.Hemoglobin_A1c,
    lab_results.General_urine_examination,
    lab_results.prescid,
	lab_results.date_taken
FROM 
    patient
INNER JOIN 
    prescribtion ON patient.patientid = prescribtion.patientid
INNER JOIN 
    doctor ON prescribtion.doctorid = doctor.doctorid
LEFT JOIN 
    lab_results ON prescribtion.prescid = lab_results.prescid
WHERE 
    lab_results.prescid = @search
		 ORDER BY 
	     lab_results.date_taken DESC;


 ", con);
                cmd.Parameters.AddWithValue("@search", prescid);


                using (SqlDataReader dr = cmd.ExecuteReader())
                {
                    while (dr.Read())
                    {
                        ptclass1 field = new ptclass1();


                        field.med_id = dr["lab_result_id"].ToString();
                        field.Low_density_lipoprotein_LDL = dr["Low_density_lipoprotein_LDL"].ToString();
                        field.High_density_lipoprotein_HDL = dr["High_density_lipoprotein_HDL"].ToString();
                        field.Total_cholesterol = dr["Total_cholesterol"].ToString();
                        field.Triglycerides = dr["Triglycerides"].ToString();
                        field.SGPT_ALT = dr["SGPT_ALT"].ToString();
                        field.SGOT_AST = dr["SGOT_AST"].ToString();
                        field.Alkaline_phosphates_ALP = dr["Alkaline_phosphates_ALP"].ToString();
                        field.Total_bilirubin = dr["Total_bilirubin"].ToString();
                        field.Direct_bilirubin = dr["Direct_bilirubin"].ToString();
                        field.Albumin = dr["Albumin"].ToString();
                        field.JGlobulin = dr["JGlobulin"].ToString();
                        field.Urea = dr["Urea"].ToString();
                        field.Creatinine = dr["Creatinine"].ToString();
                        field.Uric_acid = dr["Uric_acid"].ToString();
                        field.Sodium = dr["Sodium"].ToString();
                        field.Potassium = dr["Potassium"].ToString();
                        field.Chloride = dr["Chloride"].ToString();
                        field.Calcium = dr["Calcium"].ToString();
                        field.Phosphorous = dr["Phosphorous"].ToString();
                        field.Magnesium = dr["Magnesium"].ToString();
                        field.Amylase = dr["Amylase"].ToString();
                        field.Hemoglobin = dr["Hemoglobin"].ToString();
                        field.Malaria = dr["Malaria"].ToString();
                        field.ESR = dr["ESR"].ToString();
                        field.Blood_grouping = dr["Blood_grouping"].ToString();
                        field.Blood_sugar = dr["Blood_sugar"].ToString();
                        field.CBC = dr["CBC"].ToString();
                        field.Cross_matching = dr["Cross_matching"].ToString();
                        field.TPHA = dr["TPHA"].ToString();
                        field.Human_immune_deficiency_HIV = dr["Human_immune_deficiency_HIV"].ToString();
                        field.Hepatitis_B_virus_HBV = dr["Hepatitis_B_virus_HBV"].ToString();
                        field.Hepatitis_C_virus_HCV = dr["Hepatitis_C_virus_HCV"].ToString();
                        field.Brucella_melitensis = dr["Brucella_melitensis"].ToString();
                        field.Brucella_abortus = dr["Brucella_abortus"].ToString();
                        field.C_reactive_protein_CRP = dr["C_reactive_protein_CRP"].ToString();
                        field.Rheumatoid_factor_RF = dr["Rheumatoid_factor_RF"].ToString();
                        field.Antistreptolysin_O_ASO = dr["Antistreptolysin_O_ASO"].ToString();
                        field.Toxoplasmosis = dr["Toxoplasmosis"].ToString();
                        field.Typhoid_hCG = dr["Typhoid_hCG"].ToString();
                        field.Hpylori_antibody = dr["Hpylori_antibody"].ToString();
                        field.Stool_occult_blood = dr["Stool_occult_blood"].ToString();
                        field.General_stool_examination = dr["General_stool_examination"].ToString();
                        field.Thyroid_profile = dr["Thyroid_profile"].ToString();
                        field.Triiodothyronine_T3 = dr["Triiodothyronine_T3"].ToString();
                        field.Thyroxine_T4 = dr["Thyroxine_T4"].ToString();
                        field.Thyroid_stimulating_hormone_TSH = dr["Thyroid_stimulating_hormone_TSH"].ToString();
                        field.Progesterone_Female = dr["Progesterone_Female"].ToString();
                        field.Follicle_stimulating_hormone_FSH = dr["Follicle_stimulating_hormone_FSH"].ToString();
                        field.Estradiol = dr["Estradiol"].ToString();
                        field.Luteinizing_hormone_LH = dr["Luteinizing_hormone_LH"].ToString();
                        field.Testosterone_Male = dr["Testosterone_Male"].ToString();
                        field.Prolactin = dr["Prolactin"].ToString();
                        field.Seminal_Fluid_Analysis_Male_B_HCG = dr["Seminal_Fluid_Analysis_Male_B_HCG"].ToString();
                        field.Urine_examination = dr["Urine_examination"].ToString();
                        field.Stool_examination = dr["Stool_examination"].ToString();
                        field.Sperm_examination = dr["Sperm_examination"].ToString();
                        field.Virginal_swab_trichomonas_virginals = dr["Virginal_swab_trichomonas_virginals"].ToString();
                        field.Human_chorionic_gonadotropin_hCG = dr["Human_chorionic_gonadotropin_hCG"].ToString();
                        field.Hpylori_Ag_stool = dr["Hpylori_Ag_stool"].ToString();
                        field.Fasting_blood_sugar = dr["Fasting_blood_sugar"].ToString();
                        field.Hemoglobin_A1c = dr["Hemoglobin_A1c"].ToString();
                        field.General_urine_examination = dr["General_urine_examination"].ToString();



                        details.Add(field);
                    }
                }
            }

            return details.ToArray();
        }

        [WebMethod]
        public static string submitdata(

  string prescid, string id,
string flexCheckGeneralUrineExamination1, string flexCheckProgesteroneFemale1, string flexCheckAmylase1, string flexCheckMagnesium1,
string flexCheckPhosphorous1, string flexCheckCalcium1, string flexCheckChloride1, string flexCheckPotassium1,
string flexCheckSodium1, string flexCheckUricAcid1, string flexCheckCreatinine1, string flexCheckUrea1,
string flexCheckJGlobulin1, string flexCheckAlbumin1, string flexCheckTotalBilirubin1, string flexCheckAlkalinePhosphatesALP1,
string flexCheckSGOTAST1, string flexCheckSGPTALT1, string flexCheckLiverFunctionTest1, string flexCheckTriglycerides1,
string flexCheckTotalCholesterol1, string flexCheckHemoglobinA1c1, string flexCheckHDL1, string flexCheckLDL1,
string flexCheckFSH1, string flexCheckEstradiol1, string flexCheckLH1,
string flexCheckTestosteroneMale1, string flexCheckProlactin1, string flexCheckSeminalFluidAnalysis1, string flexCheckBHCG1,
string flexCheckUrineExamination1, string flexCheckStoolExamination1, string flexCheckHemoglobin1, string flexCheckMalaria1,
string flexCheckESR1, string flexCheckBloodGrouping1, string flexCheckBloodSugar1, string flexCheckCBC1,
string flexCheckCrossMatching1, string flexCheckTPHA1, string flexCheckHIV1, string flexCheckHBV1,
string flexCheckHCV1, string flexCheckBrucellaMelitensis1, string flexCheckBrucellaAbortus1, string flexCheckCRP1,
string flexCheckRF1, string flexCheckASO1, string flexCheckToxoplasmosis1, string flexCheckTyphoid1,
string flexCheckHpyloriAntibody1, string flexCheckStoolOccultBlood1, string flexCheckGeneralStoolExamination1, string flexCheckThyroidProfile1,
string flexCheckT31, string flexCheckT41, string flexCheckTSH1, string flexCheckSpermExamination1,
string flexCheckVirginalSwab1, string flexCheckTrichomonasVirginals1, string flexCheckHCG1, string flexCheckHpyloriAgStool1,
string flexCheckFastingBloodSugar1, string flexCheckDirectBilirubin1

)
        {
            string cs = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;


            try
            {
                using (SqlConnection con = new SqlConnection(cs))
                {
                    con.Open();

                    // Insert into lab_results table with lab_test_id to link to specific order
                    string medicationQuery = @"
                INSERT INTO lab_results (
                    prescid, lab_test_id, General_urine_examination, Progesterone_Female, Amylase, Magnesium, Phosphorous,
                    Calcium, Chloride, Potassium, Sodium, Uric_acid, Creatinine, Urea, JGlobulin, Albumin,
                    Total_bilirubin, Alkaline_phosphates_ALP, SGOT_AST, SGPT_ALT, Triglycerides,
                    Total_cholesterol, Hemoglobin_A1c, High_density_lipoprotein_HDL, Low_density_lipoprotein_LDL,
                    Follicle_stimulating_hormone_FSH, Estradiol, Luteinizing_hormone_LH, Testosterone_Male,
                    Prolactin, Seminal_Fluid_Analysis_Male_B_HCG, Urine_examination, Stool_examination, Hemoglobin, Malaria,
                    ESR, Blood_grouping, Blood_sugar, CBC, Cross_matching, TPHA, Human_immune_deficiency_HIV,
                    Hepatitis_B_virus_HBV, Hepatitis_C_virus_HCV, Brucella_melitensis, Brucella_abortus, C_reactive_protein_CRP,
                    Rheumatoid_factor_RF, Antistreptolysin_O_ASO, Toxoplasmosis, Typhoid_hCG, Hpylori_antibody, Stool_occult_blood,
                    General_stool_examination, Thyroid_profile, Triiodothyronine_T3, Thyroxine_T4, Thyroid_stimulating_hormone_TSH,
                    Sperm_examination, Virginal_swab_trichomonas_virginals, Human_chorionic_gonadotropin_hCG, Hpylori_Ag_stool,
                    Fasting_blood_sugar , Direct_bilirubin
                ) VALUES (
                    @prescid, @lab_test_id, @General_urine_examination, @Progesterone_Female, @Amylase, @Magnesium, @Phosphorous,
                    @Calcium, @Chloride, @Potassium, @Sodium, @Uric_acid, @Creatinine, @Urea, @JGlobulin, @Albumin,
                    @Total_bilirubin, @Alkaline_phosphates_ALP, @SGOT_AST, @SGPT_ALT,  @Triglycerides,
                    @Total_cholesterol, @Hemoglobin_A1c, @High_density_lipoprotein_HDL, @Low_density_lipoprotein_LDL,
      @Follicle_stimulating_hormone_FSH, @Estradiol, @Luteinizing_hormone_LH, @Testosterone_Male,
                    @Prolactin, @Seminal_Fluid_Analysis_Male_B_HCG, @Urine_examination, @Stool_examination, @Hemoglobin, @Malaria,
                    @ESR, @Blood_grouping, @Blood_sugar, @CBC, @Cross_matching, @TPHA, @Human_immune_deficiency_HIV,
                    @Hepatitis_B_virus_HBV, @Hepatitis_C_virus_HCV, @Brucella_melitensis, @Brucella_abortus, @C_reactive_protein_CRP,
                    @Rheumatoid_factor_RF, @Antistreptolysin_O_ASO, @Toxoplasmosis, @Typhoid_hCG, @Hpylori_antibody, @Stool_occult_blood,
                    @General_stool_examination, @Thyroid_profile, @Triiodothyronine_T3, @Thyroxine_T4, @Thyroid_stimulating_hormone_TSH,
                    @Sperm_examination, @Virginal_swab_trichomonas_virginals, @Human_chorionic_gonadotropin_hCG, @Hpylori_Ag_stool,
                    @Fasting_blood_sugar,@Direct_bilirubin
                )";

                    string patientUpdateQuery = "UPDATE [prescribtion] SET " +
                                                "[status] = 5 " +
                                              "WHERE [prescid] = @presc";

                    using (SqlCommand cmd = new SqlCommand(medicationQuery, con))
                    {
                        // Link the results to the specific lab order (med_id)
                        cmd.Parameters.AddWithValue("@lab_test_id", id);
                        cmd.Parameters.AddWithValue("@Direct_bilirubin", flexCheckDirectBilirubin1);
                        cmd.Parameters.AddWithValue("@prescid", prescid);
                        cmd.Parameters.AddWithValue("@General_urine_examination", flexCheckGeneralUrineExamination1);
                        cmd.Parameters.AddWithValue("@Progesterone_Female", flexCheckProgesteroneFemale1);
                        cmd.Parameters.AddWithValue("@Amylase", flexCheckAmylase1);
                        cmd.Parameters.AddWithValue("@Magnesium", flexCheckMagnesium1);
                        cmd.Parameters.AddWithValue("@Phosphorous", flexCheckPhosphorous1);
                        cmd.Parameters.AddWithValue("@Calcium", flexCheckCalcium1);
                        cmd.Parameters.AddWithValue("@Chloride", flexCheckChloride1);
                        cmd.Parameters.AddWithValue("@Potassium", flexCheckPotassium1);
                        cmd.Parameters.AddWithValue("@Sodium", flexCheckSodium1);
                        cmd.Parameters.AddWithValue("@Uric_acid", flexCheckUricAcid1);
                        cmd.Parameters.AddWithValue("@Creatinine", flexCheckCreatinine1);
                        cmd.Parameters.AddWithValue("@Urea", flexCheckUrea1);
                        cmd.Parameters.AddWithValue("@JGlobulin", flexCheckJGlobulin1);
                        cmd.Parameters.AddWithValue("@Albumin", flexCheckAlbumin1);
                        cmd.Parameters.AddWithValue("@Total_bilirubin", flexCheckTotalBilirubin1);
                        cmd.Parameters.AddWithValue("@Alkaline_phosphates_ALP", flexCheckAlkalinePhosphatesALP1);
                        cmd.Parameters.AddWithValue("@SGOT_AST", flexCheckSGOTAST1);
                        cmd.Parameters.AddWithValue("@SGPT_ALT", flexCheckSGPTALT1);

                        cmd.Parameters.AddWithValue("@Triglycerides", flexCheckTriglycerides1);
                        cmd.Parameters.AddWithValue("@Total_cholesterol", flexCheckTotalCholesterol1);
                        cmd.Parameters.AddWithValue("@Hemoglobin_A1c", flexCheckHemoglobinA1c1);
                        cmd.Parameters.AddWithValue("@High_density_lipoprotein_HDL", flexCheckHDL1);
                        cmd.Parameters.AddWithValue("@Low_density_lipoprotein_LDL", flexCheckLDL1);

                        cmd.Parameters.AddWithValue("@Follicle_stimulating_hormone_FSH", flexCheckFSH1);
                        cmd.Parameters.AddWithValue("@Estradiol", flexCheckEstradiol1);
                        cmd.Parameters.AddWithValue("@Luteinizing_hormone_LH", flexCheckLH1);
                        cmd.Parameters.AddWithValue("@Testosterone_Male", flexCheckTestosteroneMale1);
                        cmd.Parameters.AddWithValue("@Prolactin", flexCheckProlactin1);
                        cmd.Parameters.AddWithValue("@Seminal_Fluid_Analysis_Male_B_HCG", flexCheckSeminalFluidAnalysis1);
                        cmd.Parameters.AddWithValue("@Urine_examination", flexCheckUrineExamination1);
                        cmd.Parameters.AddWithValue("@Stool_examination", flexCheckStoolExamination1);
                        cmd.Parameters.AddWithValue("@Hemoglobin", flexCheckHemoglobin1);
                        cmd.Parameters.AddWithValue("@Malaria", flexCheckMalaria1);
                        cmd.Parameters.AddWithValue("@ESR", flexCheckESR1);
                        cmd.Parameters.AddWithValue("@Blood_grouping", flexCheckBloodGrouping1);
                        cmd.Parameters.AddWithValue("@Blood_sugar", flexCheckBloodSugar1);
                        cmd.Parameters.AddWithValue("@CBC", flexCheckCBC1);
                        cmd.Parameters.AddWithValue("@Cross_matching", flexCheckCrossMatching1);
                        cmd.Parameters.AddWithValue("@TPHA", flexCheckTPHA1);
                        cmd.Parameters.AddWithValue("@Human_immune_deficiency_HIV", flexCheckHIV1);
                        cmd.Parameters.AddWithValue("@Hepatitis_B_virus_HBV", flexCheckHBV1);
                        cmd.Parameters.AddWithValue("@Hepatitis_C_virus_HCV", flexCheckHCV1);
                        cmd.Parameters.AddWithValue("@Brucella_melitensis", flexCheckBrucellaMelitensis1);
                        cmd.Parameters.AddWithValue("@Brucella_abortus", flexCheckBrucellaAbortus1);
                        cmd.Parameters.AddWithValue("@C_reactive_protein_CRP", flexCheckCRP1);
                        cmd.Parameters.AddWithValue("@Rheumatoid_factor_RF", flexCheckRF1);
                        cmd.Parameters.AddWithValue("@Antistreptolysin_O_ASO", flexCheckASO1);
                        cmd.Parameters.AddWithValue("@Toxoplasmosis", flexCheckToxoplasmosis1);
                        cmd.Parameters.AddWithValue("@Typhoid_hCG", flexCheckTyphoid1);
                        cmd.Parameters.AddWithValue("@Hpylori_antibody", flexCheckHpyloriAntibody1);
                        cmd.Parameters.AddWithValue("@Stool_occult_blood", flexCheckStoolOccultBlood1);
                        cmd.Parameters.AddWithValue("@General_stool_examination", flexCheckGeneralStoolExamination1);
                        cmd.Parameters.AddWithValue("@Thyroid_profile", flexCheckThyroidProfile1);
                        cmd.Parameters.AddWithValue("@Triiodothyronine_T3", flexCheckT31);
                        cmd.Parameters.AddWithValue("@Thyroxine_T4", flexCheckT41);
                        cmd.Parameters.AddWithValue("@Thyroid_stimulating_hormone_TSH", flexCheckTSH1);
                        cmd.Parameters.AddWithValue("@Sperm_examination", flexCheckSpermExamination1);
                        cmd.Parameters.AddWithValue("@Virginal_swab_trichomonas_virginals", flexCheckVirginalSwab1);
                        cmd.Parameters.AddWithValue("@Human_chorionic_gonadotropin_hCG", flexCheckHCG1);
                        cmd.Parameters.AddWithValue("@Hpylori_Ag_stool", flexCheckHpyloriAgStool1);
                        cmd.Parameters.AddWithValue("@Fasting_blood_sugar", flexCheckFastingBloodSugar1);


                        cmd.ExecuteNonQuery();
                    }

                    using (SqlCommand cmd1 = new SqlCommand(patientUpdateQuery, con))
                    {

                        cmd1.Parameters.AddWithValue("@id", id);
                        cmd1.Parameters.AddWithValue("@presc", prescid);

                        cmd1.ExecuteNonQuery();
                    }



                }

                return "true";
            }
            catch (Exception ex)
            {
                // Handle exceptions and return the error message with detailed information
                return "Error in submitdata method: " + ex.Message + " - " + ex.StackTrace;
            }
        }


        [WebMethod]
        public static ptclass1[] getlapprocessed(string prescid)
        {
            List<ptclass1> details = new List<ptclass1>();
            string cs = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;

            using (SqlConnection con = new SqlConnection(cs))
            {
                con.Open();
                SqlCommand cmd = new SqlCommand(@"

	   
		    SELECT 
    lab_test.med_id,
    lab_test.Low_density_lipoprotein_LDL,
    lab_test.High_density_lipoprotein_HDL,
    lab_test.Total_cholesterol,
    lab_test.Triglycerides,
    lab_test.SGPT_ALT,
    lab_test.SGOT_AST,
    lab_test.Alkaline_phosphates_ALP,
    lab_test.Total_bilirubin,
    lab_test.Direct_bilirubin,
    lab_test.Albumin,
    lab_test.JGlobulin,
    lab_test.Urea,
    lab_test.Creatinine,
    lab_test.Uric_acid,
    lab_test.Sodium,
    lab_test.Potassium,
    lab_test.Chloride,
    lab_test.Calcium,
    lab_test.Phosphorous,
    lab_test.Magnesium,
    lab_test.Amylase,
    lab_test.Hemoglobin,
    lab_test.Malaria,
    lab_test.ESR,
    lab_test.Blood_grouping,
    lab_test.Blood_sugar,
    lab_test.CBC,
    lab_test.Cross_matching,
    lab_test.TPHA,
    lab_test.Human_immune_deficiency_HIV,
    lab_test.Hepatitis_B_virus_HBV,
    lab_test.Hepatitis_C_virus_HCV,
    lab_test.Brucella_melitensis,
    lab_test.Brucella_abortus,
    lab_test.C_reactive_protein_CRP,
    lab_test.Rheumatoid_factor_RF,
    lab_test.Antistreptolysin_O_ASO,
    lab_test.Toxoplasmosis,
    lab_test.Typhoid_hCG,
    lab_test.Hpylori_antibody,
    lab_test.Stool_occult_blood,
    lab_test.General_stool_examination,
    lab_test.Thyroid_profile,
    lab_test.Triiodothyronine_T3,
    lab_test.Thyroxine_T4,
    lab_test.Thyroid_stimulating_hormone_TSH,
    lab_test.Progesterone_Female,
    lab_test.Follicle_stimulating_hormone_FSH,
    lab_test.Estradiol,
    lab_test.Luteinizing_hormone_LH,
    lab_test.Testosterone_Male,
    lab_test.Prolactin,
    lab_test.Seminal_Fluid_Analysis_Male_B_HCG,
    lab_test.Urine_examination,
    lab_test.Stool_examination,
    lab_test.Sperm_examination,
    lab_test.Virginal_swab_trichomonas_virginals,
    lab_test.Human_chorionic_gonadotropin_hCG,
    lab_test.Hpylori_Ag_stool,
    lab_test.Fasting_blood_sugar,
    lab_test.Hemoglobin_A1c,
    lab_test.General_urine_examination,
    lab_test.prescid,
	    lab_test.date_taken
FROM 
    patient
INNER JOIN 
    prescribtion ON patient.patientid = prescribtion.patientid
INNER JOIN 
    doctor ON prescribtion.doctorid = doctor.doctorid
LEFT JOIN 
    lab_test ON prescribtion.prescid = lab_test.prescid
WHERE 

  
     lab_test.prescid = @prescid
	 ORDER BY 
    lab_test.date_taken DESC;


 ", con);
              

                cmd.Parameters.AddWithValue("@prescid", prescid);
                using (SqlDataReader dr = cmd.ExecuteReader())
                {
                    while (dr.Read())
                    {
                        ptclass1 field = new ptclass1();


                        field.med_id = dr["med_id"].ToString();
                        field.Low_density_lipoprotein_LDL = dr["Low_density_lipoprotein_LDL"].ToString();
                        field.High_density_lipoprotein_HDL = dr["High_density_lipoprotein_HDL"].ToString();
                        field.Total_cholesterol = dr["Total_cholesterol"].ToString();
                        field.Triglycerides = dr["Triglycerides"].ToString();
                        field.SGPT_ALT = dr["SGPT_ALT"].ToString();
                        field.SGOT_AST = dr["SGOT_AST"].ToString();
                        field.Alkaline_phosphates_ALP = dr["Alkaline_phosphates_ALP"].ToString();
                        field.Total_bilirubin = dr["Total_bilirubin"].ToString();
                        field.Direct_bilirubin = dr["Direct_bilirubin"].ToString();
                        field.Albumin = dr["Albumin"].ToString();
                        field.JGlobulin = dr["JGlobulin"].ToString();
                        field.Urea = dr["Urea"].ToString();
                        field.Creatinine = dr["Creatinine"].ToString();
                        field.Uric_acid = dr["Uric_acid"].ToString();
                        field.Sodium = dr["Sodium"].ToString();
                        field.Potassium = dr["Potassium"].ToString();
                        field.Chloride = dr["Chloride"].ToString();
                        field.Calcium = dr["Calcium"].ToString();
                        field.Phosphorous = dr["Phosphorous"].ToString();
                        field.Magnesium = dr["Magnesium"].ToString();
                        field.Amylase = dr["Amylase"].ToString();
                        field.Hemoglobin = dr["Hemoglobin"].ToString();
                        field.Malaria = dr["Malaria"].ToString();
                        field.ESR = dr["ESR"].ToString();
                        field.Blood_grouping = dr["Blood_grouping"].ToString();
                        field.Blood_sugar = dr["Blood_sugar"].ToString();
                        field.CBC = dr["CBC"].ToString();
                        field.Cross_matching = dr["Cross_matching"].ToString();
                        field.TPHA = dr["TPHA"].ToString();
                        field.Human_immune_deficiency_HIV = dr["Human_immune_deficiency_HIV"].ToString();
                        field.Hepatitis_B_virus_HBV = dr["Hepatitis_B_virus_HBV"].ToString();
                        field.Hepatitis_C_virus_HCV = dr["Hepatitis_C_virus_HCV"].ToString();
                        field.Brucella_melitensis = dr["Brucella_melitensis"].ToString();
                        field.Brucella_abortus = dr["Brucella_abortus"].ToString();
                        field.C_reactive_protein_CRP = dr["C_reactive_protein_CRP"].ToString();
                        field.Rheumatoid_factor_RF = dr["Rheumatoid_factor_RF"].ToString();
                        field.Antistreptolysin_O_ASO = dr["Antistreptolysin_O_ASO"].ToString();
                        field.Toxoplasmosis = dr["Toxoplasmosis"].ToString();
                        field.Typhoid_hCG = dr["Typhoid_hCG"].ToString();
                        field.Hpylori_antibody = dr["Hpylori_antibody"].ToString();
                        field.Stool_occult_blood = dr["Stool_occult_blood"].ToString();
                        field.General_stool_examination = dr["General_stool_examination"].ToString();
                        field.Thyroid_profile = dr["Thyroid_profile"].ToString();
                        field.Triiodothyronine_T3 = dr["Triiodothyronine_T3"].ToString();
                        field.Thyroxine_T4 = dr["Thyroxine_T4"].ToString();
                        field.Thyroid_stimulating_hormone_TSH = dr["Thyroid_stimulating_hormone_TSH"].ToString();
                        field.Progesterone_Female = dr["Progesterone_Female"].ToString();
                        field.Follicle_stimulating_hormone_FSH = dr["Follicle_stimulating_hormone_FSH"].ToString();
                        field.Estradiol = dr["Estradiol"].ToString();
                        field.Luteinizing_hormone_LH = dr["Luteinizing_hormone_LH"].ToString();
                        field.Testosterone_Male = dr["Testosterone_Male"].ToString();
                        field.Prolactin = dr["Prolactin"].ToString();
                        field.Seminal_Fluid_Analysis_Male_B_HCG = dr["Seminal_Fluid_Analysis_Male_B_HCG"].ToString();
                        field.Urine_examination = dr["Urine_examination"].ToString();
                        field.Stool_examination = dr["Stool_examination"].ToString();
                        field.Sperm_examination = dr["Sperm_examination"].ToString();
                        field.Virginal_swab_trichomonas_virginals = dr["Virginal_swab_trichomonas_virginals"].ToString();
                        field.Human_chorionic_gonadotropin_hCG = dr["Human_chorionic_gonadotropin_hCG"].ToString();
                        field.Hpylori_Ag_stool = dr["Hpylori_Ag_stool"].ToString();
                        field.Fasting_blood_sugar = dr["Fasting_blood_sugar"].ToString();
                        field.Hemoglobin_A1c = dr["Hemoglobin_A1c"].ToString();
                        field.General_urine_examination = dr["General_urine_examination"].ToString();

                        details.Add(field);
                    }
                }
            }

            return details.ToArray();
        }
    }
}